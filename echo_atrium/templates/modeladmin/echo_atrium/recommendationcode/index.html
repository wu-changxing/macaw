{% extends "wagtailadmin/base.html" %}
{% load i18n wagtailadmin_tags %}

{% block extra_css %}
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.17/dist/tailwind.min.css" rel="stylesheet">
{% endblock %}

{% include "wagtailadmin/shared/pagination_nav.html" with items=user_profiles %}


{% block content %}
    <header class="py-4 px-8 bg-gray-100">
        <div class="flex justify-between items-center">
            <h1 class="text-2xl font-semibold">{% trans "Recommendation Codes" %}</h1>
            <div class="flex items-center">
                <form class="flex items-center" action="." method="GET" novalidate>
                    <input type="text" name="q" placeholder="{% trans 'Search codes and usernames' %}"
                           value="{{ search_query|default:'' }}"
                           class="border border-gray-300 px-3 py-2 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500"/>
                    <button type="submit"
                            class="ml-2 text-white bg-indigo-500 px-4 py-2 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">{% trans 'Search' %}</button>
                </form>
            </div>
        </div>
    </header>

    <form method="POST" action=".">
        {% csrf_token %}
        {{ form.username.label_tag }} {{ form.username }}
        {{ form.password.label_tag }} {{ form.password }}
        {{ form.level.label_tag }} {{ form.level }}
        {{ form.badge.label_tag }} {{ form.badge }}  <!-- Add badge field -->
        {{ form.recommendation_code.label_tag }} {{ form.recommendation_code }}
        <button type="submit"
                class="text-white w-full h-16 bg-indigo-500 px-4 py-2 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">{% trans 'Add' %}</button>
    </form>

    <table class="min-w-full divide-y divide-gray-200 mt-4">
        <thead class="bg-gray-50">
        <tr>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">{% trans "Code" %}</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">{% trans "User" %}</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">{% trans "Created At" %}</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">{% trans "Level" %}</th>
        </tr>
        </thead>
        {% for user_profile in user_profiles %}
            <tr>
                <td class="px-6 py-4 whitespace-nowrap">
                    {% for recommendation_code in user_profile.recommendationcode_set.all %}
                        {{ recommendation_code.code }} (Limit: {{ recommendation_code.use_limit }})
                        {% if not forloop.last %}, {% endif %}
                    {% endfor %}
                </td>
                <td class="px-6 py-4 whitespace-nowrap">{{ user_profile.user.username }}</td>
                <td class="px-6 py-4 whitespace-nowrap">{{ user_profile.user.date_joined|date:'Y-m-d H:i:s' }}</td>
                <td class="px-6 py-4 whitespace-nowrap">{{ user_profile.level }}</td>
                <td class="px-6 py-4 whitespace-nowrap">{{ user_profile.badge }}</td>
            </tr>
        {% empty %}
            <tr>
                <td colspan="5" class="px-6 py-4 whitespace-nowrap">{% trans "No users found." %}</td>
            </tr>
        {% endfor %}

    </table>
    {% include "wagtailadmin/shared/pagination_nav.html" with items=recommendation_codes %}
{% endblock %}
{% block extra_js %}
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            document.getElementById('add-code-button').addEventListener('click', function () {
                document.getElementById('add-code-modal').classList.remove('hidden');
            });

            document.getElementById('cancel-button').addEventListener('click', function () {
                document.getElementById('add-code-modal').classList.add('hidden');
            });
        });
    </script>
{% endblock %}

